<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>{% block title %}GICA Generador{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/tailwind_custom.css' %}">
    <style>
        /* Modern Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 4px;
        }

        .dark ::-webkit-scrollbar-thumb {
            background-color: #475569;
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: #94a3b8;
        }

        .dark ::-webkit-scrollbar-thumb:hover {
            background-color: #64748b;
        }

        /* Glassmorphism utilities */
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .dark .glass-panel {
            background: rgba(15, 23, 42, 0.8);
        }

        /* Modern Input Styles */
        .input-modern {
            width: 100%;
            border-radius: 0.75rem;
            /* rounded-xl */
            border-width: 1px;
            border-color: #e2e8f0;
            /* slate-200 */
            background-color: #f8fafc;
            /* slate-50 */
            color: #1e293b;
            /* slate-800 */
            transition: all 0.2s;
        }

        .dark .input-modern {
            border-color: #334155;
            /* slate-700 */
            background-color: rgba(15, 23, 42, 0.5);
            /* slate-900/50 */
            color: #f1f5f9;
            /* slate-100 */
        }

        .input-modern:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
            --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);
            box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000);
            --tw-ring-color: rgba(59, 130, 246, 0.2);
            /* blue-500/20 */
            border-color: #3b82f6;
            /* blue-500 */
        }
    </style>
</head>

<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200 font-sans antialiased"
    x-data="appLayout()">
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <aside :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'"
            class="fixed lg:static inset-y-0 left-0 z-40 w-64 bg-slate-950 dark:bg-slate-950 border-r border-slate-800 transform transition-transform duration-300 ease-in-out flex flex-col">
            <div class="flex items-center justify-between h-16 px-6 border-b border-slate-800">
                <a href="{% url 'dashboard' %}" class="flex items-center gap-2 text-slate-100 font-bold">
                    <i class="fas fa-graduation-cap text-blue-500 text-xl"></i>
                    <span>TesisAI Gen</span>
                </a>
                <button @click="sidebarOpen = false" class="lg:hidden p-2 text-slate-400 hover:text-white rounded-lg">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
                <a href="{% url 'dashboard' %}"
                    class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-300 hover:bg-slate-800 hover:text-white transition-colors {% if request.resolver_match.url_name == 'dashboard' %}bg-slate-800 text-white{% endif %}">
                    <i class="fas fa-chart-line w-5 text-center text-blue-500"></i>
                    <span>Dashboard</span>
                </a>
                <a href="{% url 'wizard_generacion' %}"
                    class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-300 hover:bg-slate-800 hover:text-white transition-colors {% if request.resolver_match.url_name == 'wizard_generacion' %}bg-slate-800 text-white{% endif %}">
                    <i class="fas fa-plus-circle w-5 text-center text-emerald-500"></i>
                    <span>Nuevo Proyecto</span>
                </a>
                <div class="pt-4 mt-4 border-t border-slate-800">
                    <p class="px-4 mb-2 text-xs font-semibold text-slate-500 uppercase tracking-wider">Administración
                    </p>
                    <a href="{% url 'prompts_list' %}"
                        class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-300 hover:bg-slate-800 hover:text-white transition-colors {% if 'prompts' in request.resolver_match.url_name %}bg-slate-800 text-white{% endif %}">
                        <i class="fas fa-file-lines w-5 text-center text-slate-400"></i>
                        <span>Gestión Prompts</span>
                    </a>
                    <a href="{% url 'historial' %}"
                        class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-300 hover:bg-slate-800 hover:text-white transition-colors {% if request.resolver_match.url_name == 'historial' %}bg-slate-800 text-white{% endif %}">
                        <i class="fas fa-clock-rotate-left w-5 text-center text-slate-400"></i>
                        <span>Historial</span>
                    </a>
                </div>
            </nav>
            <div class="p-4 border-t border-slate-800 space-y-2">
                <button @click="toggleDarkMode()"
                    class="flex items-center gap-3 w-full px-4 py-3 rounded-xl text-slate-300 hover:bg-slate-800 transition-colors">
                    <i class="fas w-5 text-center"
                        :class="darkMode ? 'fa-sun text-amber-400' : 'fa-moon text-slate-400'"></i>
                    <span x-text="darkMode ? 'Modo claro' : 'Modo oscuro'"></span>
                </button>
            </div>
        </aside>

        <!-- Overlay móvil -->
        <div x-show="sidebarOpen" x-transition:enter="transition-opacity ease-out duration-300"
            x-transition:leave="transition-opacity ease-in duration-200" @click="sidebarOpen = false"
            class="fixed inset-0 bg-black/50 z-30 lg:hidden" style="display: none;"></div>

        <!-- Main -->
        <div class="flex-1 flex flex-col min-w-0">
            <!-- Top Bar -->
            <header
                class="h-16 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between px-4 lg:px-8">
                <button @click="sidebarOpen = true"
                    class="lg:hidden p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700">
                    <i class="fas fa-bars text-slate-600 dark:text-slate-300"></i>
                </button>
                <div class="flex-1"></div>
                <button @click="toggleDarkMode()"
                    class="lg:hidden p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300">
                    <i class="fas" :class="darkMode ? 'fa-sun text-amber-400' : 'fa-moon'"></i>
                </button>
            </header>

            <!-- Content -->
            <main class="flex-1 overflow-auto p-6 lg:p-8">
                {% block content %}{% endblock %}
            </main>
        </div>
    </div>

    <!-- Toasts -->
    <div class="fixed top-4 right-4 z-50 space-y-2 max-w-sm w-full" x-ref="toastContainer">
        <template x-for="(toast, index) in toasts" :key="index">
            <div x-show="toast.visible" x-transition:enter="transform ease-out duration-300"
                x-transition:enter-start="translate-x-full opacity-0" x-transition:enter-end="translate-x-0 opacity-100"
                x-transition:leave="transition ease-in duration-200" :class="{
                     'bg-emerald-50 dark:bg-emerald-900/30 border-emerald-200 dark:border-emerald-800 text-emerald-800 dark:text-emerald-200': toast.type === 'success',
                     'bg-rose-50 dark:bg-rose-900/30 border-rose-200 dark:border-rose-800 text-rose-800 dark:text-rose-200': toast.type === 'error',
                     'bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-800 text-blue-800 dark:text-blue-200': toast.type === 'info'
                 }" class="rounded-xl border shadow-lg p-4 flex items-start gap-3">
                <i class="fas mt-0.5" :class="{
                    'fa-circle-check text-emerald-500': toast.type === 'success',
                    'fa-circle-xmark text-rose-500': toast.type === 'error',
                    'fa-circle-info text-blue-500': toast.type === 'info'
                }"></i>
                <p class="flex-1 text-sm font-medium" x-text="toast.message"></p>
            </div>
        </template>
    </div>

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <script>
        function appLayout() {
            const messages = [
                {% for message in messages %}
        { type: '{{ message.tags|default:"info" }}', message: '{{ message|escapejs }}', visible: true },
        {% endfor %}
            ];
        const stored = localStorage.getItem('darkMode') === 'true';
        if (stored) document.documentElement.classList.add('dark');
        return {
            sidebarOpen: false,
            darkMode: stored,
            toasts: messages,
            init() {
                this.toasts.forEach((t, i) => {
                    setTimeout(() => { t.visible = false; }, 4000 + i * 200);
                });
            },
            toggleDarkMode() {
                this.darkMode = !this.darkMode;
                document.documentElement.classList.toggle('dark', this.darkMode);
                localStorage.setItem('darkMode', this.darkMode);
            }
        };
        }
    </script>
    {% block scripts %}{% endblock %}
</body>

</html>